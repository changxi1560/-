# AutoCar 自动化课程用自动巡线小车

## 简介

作者：畅希，同组成员+提供代码更改思路：Gaster

本项目是 2025 年哈尔滨工业大学（深圳）自动化认识与实践课程考核项目：自动巡线小车的对应代码，参考自psp2023年同期课程考核代码

本次考核仅包括竞速部分

在竞速部分，小车需在起点用机械夹爪拿起一个圆柱体，后循迹到终点，途中会遇到半圆形弯道、直角转弯等复杂情况，需要灵活处理。到了终点，需要将圆柱体平稳放下。

注：由于2022级涉及到考核避障部分，本代码中含有避障部分代码实现方式，有兴趣的可以自己调调看

对应开发板：arduino mega 2560

考核时间:2025.6.24 9:00，分数:/35

## 项目结构

- AutoCar_def: 定义了一些常量和引脚，根据实际情况修改
- control: 控制小车的运动，包括三个部分
  - runMode：根据红外传感器的输出来决定小车运动模式
  - motorControl：根据小车运动模式选择小车两轮的目标速度
  - carRun：根据小车两轮的目标速度来输出 PWM 波控制小车
- ctrt：红外模块相关功能
- encoder：编码器中断函数
- pid：pid 控制器
- robotic_arm：机械臂控制

## 功能具体实现

在考核中最复杂的一部分就是直角转弯，使用常规的控制方法都很容易冲出预定轨迹。因此我们采用了寄存器+越界检测+倒车的方式，即即使实际上安装在车头部分的红外探测模块（ctrt）已经无法检测到线路，我们也可以根据 ctrt 以前的状态来判断目前是应该左转还是右转，在直角弯无法一次性转向中加入倒车，这样的好处是在车完全冲出预定轨迹之前就可以进行纠正，同时降低识别到其他线的概率，能够回到预定轨迹上。

## 代码运行逻辑

```
1、上电
2、机械臂运动，夹取物品
3、红外模块读取数据，根据这个数据确定运动的模式（如左转、直行）
4、根据运动的模式设置左右两轮的目标速度
5、根据编码器的值计算轮子当前速度
6、用pid根据目标速度、当前速度计算出输出量以驱动电机
7、当遇到终点线时，执行最后的动作，之后不再运动
```

## 使用方法

- 根据实际接线情况修改 'AutoCar_def.h' 文件，同时修改control.ino中的motorcontrol函数关于左右转差速部分
- 将代码刷入开发板

## 对于此课程的一些小小的牢骚（不想看的可以略过）

- 工图部分教的很水，solidworks教完跟自学没有区别（至少我觉得是这样）
- 实验报告老师要求手写，还要求同组内除了数据之外不能一样
- 在6.19下午通知6.24上午进行循迹测试（原本商量的是在所有考试结束之后），时间很赶，而且到最后如果需要换原件还会扣分（又不是我自己搞坏的管我屁事还要扣我分）
